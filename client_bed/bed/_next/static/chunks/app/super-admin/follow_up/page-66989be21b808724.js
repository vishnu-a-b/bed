(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9059],{5435:function(e,t,a){Promise.resolve().then(a.bind(a,6648))},6648:function(e,t,a){"use strict";a.d(t,{default:function(){return l}});var n=a(7437),s=a(2265),r=a(3618),o=a(386);function l(){var e;let t;let[a,l]=(0,s.useState)([]),[c,i]=(0,s.useState)(0),[d,u]=(0,s.useState)(0),[m,f]=(0,s.useState)(10),[p,h]=(0,s.useState)(""),[g,x]=(0,s.useState)("all"),[y,v]=(0,s.useState)("all"),[w,S]=(0,s.useState)(()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),2).toISOString().split("T")[0]}),[b,_]=(0,s.useState)(()=>new Date().toISOString().split("T")[0]),[j,N]=(0,s.useState)(""),k=(0,o.v9)(e=>e.update.refresh),C=(0,o.v9)(e=>e.payment.id),D=(0,s.useCallback)((e=e=>{N(e),u(0)},function(){for(var a=arguments.length,n=Array(a),s=0;s<a;s++)n[s]=arguments[s];clearTimeout(t),t=setTimeout(()=>{e(...n)},500)}),[]),I=(e,t)=>e.map(e=>{let a=t.filter(t=>t.supporter._id===e._id),n=a.filter(e=>"completed"===e.status).length;return{...e,payments:a,completedPayments:n,totalPayments:a.length}});async function T(){try{let e="";"all"!==g&&(e="status__eq=".concat(g,"&"));let t="";"all"!==y&&(t="paymentMode__eq=".concat(y,"&"));let a=j?"search=".concat(j,"&"):"",n={filters:{startDate:w?new Date(w).toISOString():void 0,endDate:b?new Date(b).toISOString():void 0}},s=await r.YD.post("/bed-payments?".concat("limit=Infinity&").concat(e).concat(t).concat(a,"sort=-paymentDate"),n,{headers:{"Content-Type":"application/json"}}),o=await r.YD.post("/supporter/get?limit=Infinity&",n,{headers:{"Content-Type":"application/json"}});console.log("Payments:",s.data.data),console.log("Supporters:",o.data.data);let l=s.data.data,c=o.data.data,u=l.items||l,f=c.items||c,p=I(f,u),h=p;j&&(h=p.filter(e=>e.name.toLowerCase().includes(j.toLowerCase())||e.user.mobileNo.includes(j)||e.user.email.toLowerCase().includes(j.toLowerCase())));let x=d*m,v=h.slice(x,x+m);return console.log(v),i(h.length),v}catch(e){return console.error("Error fetching payment data:",e),[]}}return(0,s.useEffect)(()=>{(async function(){let e=await T();e&&l(e)})()},[d,m,j,g,y,w,b,k,C]),(0,n.jsx)("div",{className:"flex flex-col items-center p-4",children:(0,n.jsx)("div",{className:"container mx-auto py-10",children:(0,n.jsxs)("div",{className:"flex flex-col gap-4 mb-4",children:[(0,n.jsx)("div",{className:"flex flex-col sm:flex-row justify-between gap-4"}),(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("label",{className:"text-sm font-medium mb-1",children:"Search"}),(0,n.jsx)("input",{type:"text",value:p,onChange:e=>{let t=e.target.value;h(t),D(t)},placeholder:"Search by name, phone number...",className:"p-2 border rounded flex-grow max-w-md"})]}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("label",{className:"text-sm font-medium mb-1",children:"Start Date"}),(0,n.jsx)("input",{type:"date",value:w,onChange:e=>{S(e.target.value),u(0)},className:"p-2 border border-gray-300 rounded"})]}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("label",{className:"text-sm font-medium mb-1",children:"End Date"}),(0,n.jsx)("input",{type:"date",value:b,onChange:e=>{_(e.target.value),u(0)},className:"p-2 border border-gray-300 rounded"})]})]})]})})})}},3618:function(e,t,a){"use strict";a.d(t,{YD:function(){return d},hP:function(){return c},kS:function(){return i},pH:function(){return r}});var n=a(3464);let s="https://api.donatebed.shanthibhavan.in/v1",r=async(e,t)=>{let a=await n.Z.post("".concat(s,"/auth/jwt/create"),{username:e,password:t});return l(a.data.data.accessToken,a.data.data.refreshToken),a.data.data},o=async e=>(await n.Z.post("".concat(s,"/auth/jwt/verify"),{refreshToken:e})).data.data,l=(e,t)=>{sessionStorage.setItem("access_token",e),localStorage.setItem("refresh_token",t)},c=()=>sessionStorage.getItem("access_token"),i=()=>{sessionStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.reload()},d=n.Z.create({baseURL:s,headers:{"Content-Type":"multipart/form-data"}});d.interceptors.request.use(e=>{let t=c();return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),d.interceptors.response.use(e=>e,async e=>{var t;let a=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!a._retry){a._retry=!0;let e=localStorage.getItem("refresh_token");if(e)try{let{accessToken:t}=await o(e);return l(t,e),a.headers.Authorization="Bearer "+t,d(a)}catch(e){throw i(),window.location.reload(),e}else i(),window.location.reload()}throw e})}},function(e){e.O(0,[3464,8575,2971,2117,1744],function(){return e(e.s=5435)}),_N_E=e.O()}]);