(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9537],{9537:function(e,a,s){Promise.resolve().then(s.bind(s,2714))},2714:function(e,a,s){"use strict";s.d(a,{default:function(){return L}});var r=s(7437),t=s(2265),l=s(8438),n=s(3618),i=s(386),d=s(4291),o=s(2381),c=s(5060),m=s(5937),p=s(9376),u=s(7520),x=s(3455),h=s(1671),g=s(1723),j=s(9388),y=s(6865),b=s(3193),v=s(4978);let f=async(e,a,s)=>{let r=(0,n.hP)();return(await fetch("".concat("https://api.donatebed.shanthibhavan.in/v1","/bed-payments-ind/").concat(e,"/approve"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({approved:a,remarks:s})})).json()},N=[{accessorKey:"supporter.name",header:"Name"},{accessorKey:"supporter.user.mobileNo",header:"Phone No"},{accessorKey:"paymentDate",header:"Date",cell:e=>{var a,s;let{row:r}=e;return new Date((null==r?void 0:null===(a=r.original)||void 0===a?void 0:a.paymentDate)||(null==r?void 0:null===(s=r.original)||void 0===s?void 0:s.createdAt)).toLocaleDateString()}},{accessorKey:"amount",header:"Amount",cell:e=>{let{row:a}=e;a.original;let s=Number(a.getValue("amount"));return"₹".concat(s.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}))}},{accessorKey:"supporter.bed.bedNo",header:"Bed"},{accessorKey:"status",header:"Status",cell:e=>{let{row:a}=e,s=a.getValue("status"),t=a.original;return"offline"===t.paymentMode?!0===t.isApproved?(0,r.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs bg-green-100 text-green-800 flex items-center gap-1",children:[(0,r.jsx)(h.Z,{className:"w-3 h-3"}),"Approved"]}):(0,r.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800 flex items-center gap-1",children:[(0,r.jsx)(g.Z,{className:"w-3 h-3"}),"Pending Approval"]}):(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("completed"===s?"bg-green-100 text-green-800":"failed"===s?"bg-red-100 text-red-800":"pending"===s?"bg-yellow-100 text-yellow-800":"cancelled"===s?"bg-gray-100 text-gray-800":"refunded"===s||"partially_refunded"===s?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800"),children:s.charAt(0).toUpperCase()+s.slice(1).replace("_"," ")})}},{accessorKey:"paymentMode",header:"Mode",cell:e=>{let{row:a}=e,s=a.getValue("paymentMode");return(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("online"===s?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:(null==s?void 0:s.charAt(0).toUpperCase())+(null==s?void 0:s.slice(1))||"Online"})}},{accessorKey:"viewDetails",header:"Actions",cell:e=>{let a=e.row.original;return(0,r.jsxs)(d.Vq,{children:[(0,r.jsx)(d.hg,{className:"underline",children:(0,r.jsx)("button",{className:"px-4 p-1 text-white bg-sidebar-primary rounded-full",children:"View"})}),(0,r.jsx)(d.cZ,{className:"p-6 max-w-4xl max-h-[80vh] overflow-y-auto",children:(0,r.jsx)(w,{data:a})})]})}}],_=e=>{let{payment:a,onApprovalUpdate:s}=e,[l,n]=(0,t.useState)(!1),[i,d]=(0,t.useState)(""),[p,u]=(0,t.useState)(!1),g=async e=>{if(!1===e&&!i.trim()){u(!0);return}n(!0);try{let r=await f(a._id,e,i);console.log(r),r.success?(s(a._id,e),v.Z.success("Payment ".concat(e?"approved":"rejected"," successfully").concat(e?". Receipt email sent to donor.":"")),u(!1),d("")):v.Z.error("Error processing approval")}catch(e){console.error("Error:",e),v.Z.error("Error processing approval")}finally{n(!1)}};return"offline"!==a.paymentMode?null:!0===a.isApproved?(0,r.jsxs)(m.bZ,{children:[(0,r.jsx)(h.Z,{className:"h-4 w-4"}),(0,r.jsxs)(m.X,{children:["Payment approved and receipt sent to donor.",a.approvedAt&&(0,r.jsxs)("span",{className:"block text-xs text-gray-500 mt-1",children:["Approved on ",(0,x.Sp)(a.approvedAt)]})]})]}):!1===a.isApproved?(0,r.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,r.jsxs)(m.bZ,{children:[(0,r.jsx)(j.Z,{className:"h-4 w-4"}),(0,r.jsx)(m.X,{children:"Payment has been rejected."})]}),p&&(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"approval-remarks",className:"text-sm font-medium",children:"Remarks"}),(0,r.jsx)("textarea",{id:"approval-remarks",value:i,onChange:e=>d(e.target.value),placeholder:"Enter approval remarks...",className:"w-full mt-1 min-h-[80px] px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",rows:3})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[!p&&(0,r.jsx)(o.z,{onClick:()=>u(!0),variant:"outline",size:"sm",children:"Add Remarks"}),(0,r.jsx)(o.z,{onClick:()=>g(!0),disabled:l,className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",children:l?"Processing...":"Approve & Send Receipt"})]})]}):(0,r.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,r.jsxs)(m.bZ,{children:[(0,r.jsx)(y.Z,{className:"h-4 w-4"}),(0,r.jsx)(m.X,{children:"This manual payment is pending approval. Once approved, a receipt will be automatically sent to the donor."})]}),p&&(0,r.jsxs)("div",{children:[(0,r.jsxs)(c._,{htmlFor:"approval-remarks",className:"text-sm font-medium",children:["Remarks ",!p&&"(Required for rejection)"]}),(0,r.jsx)("textarea",{id:"approval-remarks",value:i,onChange:e=>d(e.target.value),placeholder:"Enter approval/rejection remarks...",className:"w-full mt-1 min-h-[80px] px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",rows:3})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[!p&&(0,r.jsx)(o.z,{onClick:()=>u(!0),variant:"outline",size:"sm",children:"Add Remarks"}),(0,r.jsx)(o.z,{onClick:()=>g(!0),disabled:l,className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",children:l?"Processing...":"Approve & Send Receipt"}),(0,r.jsx)(o.z,{onClick:()=>g(!1),disabled:l,className:"bg-red-600 hover:bg-red-700 text-white",size:"sm",children:l?"Processing...":"Reject"})]})]})},w=e=>{var a,s,l,n,d,c,m;let{data:h}=e,g=(0,i.I0)();(0,p.useRouter)();let j=(0,i.v9)(b.uy),[y,v]=(0,t.useState)(h);return(0,r.jsxs)("div",{className:"flex flex-col space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold border-b pb-2",children:"Payment Details"}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium mb-3",children:"Basic Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Receipt Number"}),(0,r.jsx)("p",{className:"font-mono",children:y.receiptNumber||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Amount"}),(0,r.jsxs)("p",{className:"font-semibold text-lg",children:["₹",y.amount.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Status"}),(0,r.jsx)("p",{className:"capitalize font-medium",children:y.status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Payment Mode"}),(0,r.jsx)("p",{className:"capitalize",children:y.paymentMode||"online"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Payment Date"}),(0,r.jsx)("p",{children:(0,x.Sp)(y.paymentDate||y.createdAt)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Source"}),(0,r.jsx)("p",{className:"capitalize",children:y.source||"website"})]})]})]}),(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium mb-3",children:"Payer Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Name"}),(0,r.jsx)("p",{children:y.name||((null===(a=y.payer)||void 0===a?void 0:a.name)?"".concat(y.payer.name.given_name||""," ").concat(y.payer.name.surname||"").trim():"N/A")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,r.jsx)("p",{children:y.email||(null===(s=y.payer)||void 0===s?void 0:s.email_address)||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Phone"}),(0,r.jsx)("p",{children:y.phNo||(null===(d=y.payer)||void 0===d?void 0:null===(n=d.phone)||void 0===n?void 0:null===(l=n.phone_number)||void 0===l?void 0:l.national_number)||"N/A"})]}),(null===(c=y.payer)||void 0===c?void 0:c.address)&&(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Address"}),(0,r.jsx)("p",{children:[y.payer.address.address_line_1,y.payer.address.admin_area_2,y.payer.address.admin_area_1,y.payer.address.postal_code,y.payer.address.country_code].filter(Boolean).join(", ")||y.address||"N/A"})]})]})]}),"online"===y.paymentMode&&(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium mb-3",children:"Razorpay Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.razorpay_order_id&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Razorpay Order ID"}),(0,r.jsx)("p",{className:"text-xs font-mono break-all",children:y.razorpay_order_id})]}),y.razorpay_payment_id&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Razorpay Payment ID"}),(0,r.jsx)("p",{className:"text-xs font-mono break-all",children:y.razorpay_payment_id})]}),y.razorpay_signature&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Razorpay Signature"}),(0,r.jsx)("p",{className:"text-xs font-mono break-all",children:y.razorpay_signature})]}),y.razorpay_status&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Razorpay Status"}),(0,r.jsx)("p",{className:"uppercase",children:y.razorpay_status})]}),y.razorpay_fee&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Razorpay Fee"}),(0,r.jsxs)("p",{children:["₹",y.razorpay_fee.amount.toFixed(2)]})]}),y.net_amount&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Net Amount"}),(0,r.jsxs)("p",{className:"font-medium",children:["₹",y.net_amount.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),"offline"===y.paymentMode&&(0,r.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium mb-3",children:"Manual Payment Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.manualMethod&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Payment Method"}),(0,r.jsx)("p",{className:"capitalize",children:y.manualMethod})]}),y.transactionReference&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Transaction Reference"}),(0,r.jsx)("p",{children:y.transactionReference})]}),y.remarks&&(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Remarks"}),(0,r.jsx)("p",{children:y.remarks})]}),y.recordedBy&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Recorded By"}),(0,r.jsx)("p",{children:y.recordedBy.name||y.recordedBy.email||"N/A"})]})]})]}),y.contribution&&(0,r.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium mb-3",children:"Contribution Details"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Purpose"}),(0,r.jsx)("p",{className:"capitalize",children:(null===(m=y.contribution.purpose)||void 0===m?void 0:m.replace("_"," "))||"General Donation"})]}),y.contribution.description&&(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Description"}),(0,r.jsx)("p",{children:y.contribution.description})]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium mb-3",children:"Approval Status"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Approved"}),(0,r.jsx)("p",{className:y.isApproved?"text-green-600 font-medium":"text-red-600 font-medium",children:!0===y.isApproved?"Yes":!1===y.isApproved?"No":"Pending"})]}),y.approvedBy&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Approved By"}),(0,r.jsx)("p",{children:y.approvedBy.name||y.approvedBy.email||"N/A"})]}),y.approvedAt&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Approved At"}),(0,r.jsx)("p",{children:(0,x.Sp)(y.approvedAt)})]})]})]}),(0,r.jsx)(_,{payment:y,onApprovalUpdate:(e,a)=>{v(e=>({...e,isApproved:a,approvedBy:{id:j.id},approvedAt:new Date().toISOString(),status:a?"completed":"cancelled"}))}}),y.error_details&&(y.error_details.error_code||y.error_details.error_message)&&(0,r.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium mb-3 text-red-800",children:"Error Details"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[y.error_details.error_code&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Error Code"}),(0,r.jsx)("p",{className:"font-mono text-red-600",children:y.error_details.error_code})]}),y.error_details.error_message&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Error Message"}),(0,r.jsx)("p",{className:"text-red-600",children:y.error_details.error_message})]}),y.error_details.debug_id&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Debug ID"}),(0,r.jsx)("p",{className:"font-mono text-xs",children:y.error_details.debug_id})]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium mb-3",children:"Additional Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.createdAt&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Created At"}),(0,r.jsx)("p",{children:(0,x.Sp)(y.createdAt)})]}),y.updatedAt&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Updated At"}),(0,r.jsx)("p",{children:(0,x.Sp)(y.updatedAt)})]}),y.ip_address&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"IP Address"}),(0,r.jsx)("p",{className:"font-mono text-xs",children:y.ip_address})]}),y.user_agent&&(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"User Agent"}),(0,r.jsx)("p",{className:"text-xs break-all",children:y.user_agent})]})]})]})]}),(0,r.jsx)("div",{className:"flex gap-2 pt-4 border-t",children:(0,r.jsx)(o.z,{className:"text-sm",onClick:()=>{g((0,u.R5)("bed-payments-ind")),g((0,u.h9)(y._id))},children:"Edit Payment"})})]})};var z=s(5805),D=s(525),S=s(1047),A=s(3327),k=s(5252),P=e=>{let{onStatsLoad:a}=e,[s,l]=(0,t.useState)(null),[i,d]=(0,t.useState)(!0),[o,c]=(0,t.useState)(null),m=async()=>{try{d(!0);let e=await n.YD.get("/bed-payments-ind/stats"),s=e.data.data;console.log(e),l(s),null==a||a(s)}catch(e){c("Failed to load payment statistics"),console.error("Error fetching payment stats:",e)}finally{d(!1)}};(0,t.useEffect)(()=>{m()},[]);let p=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),u=e=>{let{title:a,amount:s,count:t,icon:l,gradient:n,textColor:i="text-white",subtitle:d=""}=e;return(0,r.jsxs)("div",{className:"".concat(n," rounded-xl p-6 shadow-lg transform hover:scale-105 transition-all duration-300 relative overflow-hidden"),children:[(0,r.jsx)("div",{className:"absolute top-0 right-0 -mt-4 -mr-4 w-20 h-20 rounded-full bg-white/10"}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 -mb-6 -ml-6 w-16 h-16 rounded-full bg-white/5"}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("div",{className:"p-3 rounded-lg bg-white/20 backdrop-blur-sm",children:(0,r.jsx)(l,{className:"w-6 h-6 ".concat(i)})}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm ".concat(i,"/80 font-medium"),children:a}),d&&(0,r.jsx)("p",{className:"text-xs ".concat(i,"/60"),children:d})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-3xl font-bold ".concat(i),children:p(s)}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(z.Z,{className:"w-4 h-4 ".concat(i,"/70")}),(0,r.jsxs)("p",{className:"text-sm ".concat(i,"/80"),children:[t," payment",1!==t?"s":""]})]})]})]})]})};return i?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[1,2,3,4].map(e=>(0,r.jsx)("div",{className:"bg-gray-200 animate-pulse rounded-xl h-40"},e))}):o?(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 mb-8",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,r.jsx)(D.Z,{className:"w-5 h-5 text-red-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Error Loading Statistics"}),(0,r.jsx)("p",{className:"text-red-600",children:o})]})]})}):s?(0,r.jsxs)("div",{className:"mb-8 space-y-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Payment Statistics"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Overview of completed payments"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsx)(u,{title:"Today",amount:s.today.amount,count:s.today.count,icon:g.Z,gradient:"bg-gradient-to-br from-blue-500 via-blue-600 to-blue-700",subtitle:new Date().toLocaleDateString("en-IN",{weekday:"long",month:"short",day:"numeric"})}),(0,r.jsx)(u,{title:"This Week",amount:s.week.amount,count:s.week.count,icon:S.Z,gradient:"bg-gradient-to-br from-green-500 via-green-600 to-green-700",subtitle:"Last 7 days"}),(0,r.jsx)(u,{title:"This Month",amount:s.month.amount,count:s.month.count,icon:D.Z,gradient:"bg-gradient-to-br from-purple-500 via-purple-600 to-purple-700",subtitle:new Date().toLocaleDateString("en-IN",{month:"long",year:"numeric"})}),(0,r.jsx)(u,{title:"All Time",amount:s.total.amount,count:s.total.count,icon:A.Z,gradient:"bg-gradient-to-br from-orange-500 via-orange-600 to-orange-700",subtitle:"Avg: ".concat(p(s.total.avgAmount))})]}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,r.jsx)(k.Z,{className:"w-6 h-6 text-green-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Summary"}),(0,r.jsxs)("p",{className:"text-gray-600",children:[s.total.count," total completed payments"]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Average Payment Amount"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-600",children:p(s.total.avgAmount)})]})]})})]}):null},C=s(7162);function I(){var e;let a;let[s,d]=(0,t.useState)([]),[o,c]=(0,t.useState)(0),[m,p]=(0,t.useState)(0),[u,x]=(0,t.useState)(10),[h,g]=(0,t.useState)(""),[j,y]=(0,t.useState)("all"),[b,v]=(0,t.useState)("all"),[f,_]=(0,t.useState)(()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),2).toISOString().split("T")[0]}),w=(0,i.v9)(C.oM),[z,D]=(0,t.useState)(()=>{let e=new Date;return e.setHours(23,59,59,999),e.toISOString().split("T")[0]}),[S,A]=(0,t.useState)(""),k=(0,i.v9)(e=>e.update.refresh),I=(0,i.v9)(e=>e.payment.id),R=(0,t.useCallback)((e=e=>{A(e),p(0)},function(){for(var s=arguments.length,r=Array(s),t=0;t<s;t++)r[t]=arguments[t];clearTimeout(a),a=setTimeout(()=>{e(...r)},500)}),[]);async function M(){try{if(I){let e=await n.YD.get("/bed-payments-ind/".concat(I,"&sort=-paymentDate")),a=[];return a[0]=e.data.data,c(1),a}let e="";"all"!==j&&(e="status__eq=".concat(j,"&"));let a="";"all"!==b&&(a="paymentMode__eq=".concat(b,"&"));let s=S?"search=".concat(S,"&"):"",r="limit=".concat(u,"&"),t="skip=".concat(m*u,"&"),l={filters:{startDate:f?new Date(f).toISOString():void 0,endDate:z?(()=>{let e=new Date(z);return e.setHours(23,59,59,999),e.toISOString()})():void 0}};console.log("/bed-payments?".concat(r).concat(t).concat(e).concat(a).concat(s,"sort=-paymentDate"));let i=await n.YD.post("/bed-payments-ind?".concat(r).concat(t).concat(e).concat(a).concat(s,"sort=-paymentDate"),l,{headers:{"Content-Type":"application/json"}});console.log("hai",i);let d=i.data.data;return c(d.total||d.length),d.items||d}catch(e){return console.error("Error fetching payment data:",e),[]}}return(0,t.useEffect)(()=>{(async function(){let e=await M();e&&d(e)})()},[m,u,S,j,b,f,z,k,I]),(0,r.jsxs)("div",{className:"flex flex-col items-center p-4",children:[(0,r.jsx)(P,{}),(0,r.jsxs)("div",{className:"container mx-auto py-10",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-4 mb-6",children:[(0,r.jsx)("div",{className:"flex flex-col sm:flex-row gap-4",children:(0,r.jsxs)("div",{className:"flex flex-col flex-grow",children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-1",children:"Search"}),(0,r.jsx)("input",{type:"text",value:h,onChange:e=>{let a=e.target.value;g(a),R(a)},placeholder:"Search by supporter name, mobile, bed number, email...",className:"p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),(0,r.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:"Search in: Supporter name, mobile number, bed number, email, receipt number"})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-1",children:"Start Date"}),(0,r.jsx)("input",{type:"date",value:f,onChange:e=>{_(e.target.value),p(0)},className:"p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-1",children:"End Date"}),(0,r.jsx)("input",{type:"date",value:z,onChange:e=>{D(e.target.value),p(0)},className:"p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-1",children:"Status"}),(0,r.jsxs)("select",{value:j,onChange:e=>{y(e.target.value),p(0)},className:"p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none bg-white",children:[(0,r.jsx)("option",{value:"all",children:"All Statuses"}),(0,r.jsx)("option",{value:"completed",children:"✅ Completed"}),(0,r.jsx)("option",{value:"pending",children:"⏳ Pending"}),(0,r.jsx)("option",{value:"failed",children:"❌ Failed"}),(0,r.jsx)("option",{value:"cancelled",children:"\uD83D\uDEAB Cancelled"}),(0,r.jsx)("option",{value:"refunded",children:"\uD83D\uDCB0 Refunded"}),(0,r.jsx)("option",{value:"partially_refunded",children:"\uD83D\uDCB8 Partially Refunded"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-1",children:"Payment Mode"}),(0,r.jsxs)("select",{value:b,onChange:e=>{v(e.target.value),p(0)},className:"p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none bg-white",children:[(0,r.jsx)("option",{value:"all",children:"All Payment Modes"}),(0,r.jsx)("option",{value:"online",children:"\uD83D\uDCBB Online"}),(0,r.jsx)("option",{value:"offline",children:"\uD83C\uDFEA Offline"})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)("button",{onClick:()=>{y("completed"),p(0)},className:"px-3 py-1 rounded-full text-xs font-medium transition-colors ".concat("completed"===j?"bg-green-100 text-green-800 border border-green-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Completed"}),(0,r.jsx)("button",{onClick:()=>{y("pending"),p(0)},className:"px-3 py-1 rounded-full text-xs font-medium transition-colors ".concat("pending"===j?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Pending"}),(0,r.jsx)("button",{onClick:()=>{y("failed"),p(0)},className:"px-3 py-1 rounded-full text-xs font-medium transition-colors ".concat("failed"===j?"bg-red-100 text-red-800 border border-red-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Failed"}),(0,r.jsx)("button",{onClick:()=>{y("all"),v("all"),g(""),A(""),_(""),D(""),p(0)},className:"px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors",children:"Clear All Filters"})]})]}),(0,r.jsx)(l.w,{url:"bed-payments-ind",columns:N,data:s,totalRows:o,pageIndex:m,pageSize:u,onPageChange:p,onPageSizeChange:x,actions:{delete:"superAdmin"===w,edit:"superAdmin"===w}})]})]})}var R=s(5974),M=s(9501),F=s(3590),E=s(1229),Z=s(279),O=s(6979),B=s(662),q=s(7810),T=s(4395);let V=async(e,a)=>({items:(await n.YD.get("/".concat(a,"/").concat(e))).data.data}),U=async(e,a,s)=>(await n.YD.put("/".concat(a,"/").concat(s),e)).data.data,Y=E.z.object({razorpay_order_id:E.z.string().optional(),razorpay_payment_id:E.z.string().optional(),razorpay_signature:E.z.string().optional(),name:E.z.string().optional(),phNo:E.z.string().optional(),email:E.z.string().email().optional().or(E.z.literal("")),address:E.z.string().optional(),amount:E.z.number().min(1,{message:"Amount must be positive"}),currency:E.z.enum(["INR"]).default("INR"),status:E.z.enum(["pending","captured","failed","cancelled","refunded"]),paymentMode:E.z.enum(["online","offline"]).default("online"),manualMethod:E.z.enum(["cash","cheque","upi","bank_transfer","other"]).optional(),transactionReference:E.z.string().optional(),paymentDate:E.z.string().optional(),remarks:E.z.string().optional(),isVerified:E.z.boolean().default(!1),supporter:E.z.string().min(1,{message:"Supporter is required"}),bed:E.z.string().min(1,{message:"Bed is required"})});var K=e=>{let{paymentId:a}=e,[s,l]=(0,t.useState)({value:"offline",label:"Offline"}),[n,i]=(0,t.useState)(),[d,p]=(0,t.useState)({value:"pending",label:"Pending"}),[u,x]=(0,t.useState)({value:!1,label:"No"}),{handleSubmit:h,register:g,setValue:j,formState:{errors:y},setError:b,watch:f}=(0,M.cI)({resolver:(0,F.F)(Y),defaultValues:{currency:"INR",status:"pending",paymentMode:"offline",isVerified:!1}}),[N,_]=(0,t.useState)(!1),[w,z]=(0,t.useState)();(0,t.useEffect)(()=>{a&&(async()=>{try{var e,s,r,t,n;let d=(await V(a,"payment")).items;j("razorpay_order_id",d.razorpay_order_id||""),j("razorpay_payment_id",d.razorpay_payment_id||""),j("razorpay_signature",d.razorpay_signature||""),j("name",d.name||""),j("phNo",d.phNo||""),j("email",d.email||""),j("address",d.address||""),j("amount",d.amount),j("currency","INR"),j("status",d.status||"pending"),j("paymentMode",d.paymentMode||"offline"),j("manualMethod",d.manualMethod||void 0),j("transactionReference",d.transactionReference||""),j("paymentDate",(null===(e=d.paymentDate)||void 0===e?void 0:e.split("T")[0])||""),j("remarks",d.remarks||""),j("isVerified",d.isVerified||!1),j("supporter",(null===(s=d.supporter)||void 0===s?void 0:s._id)||""),j("bed",(null===(r=d.bed)||void 0===r?void 0:r._id)||""),p({value:d.status||"pending",label:d.status?d.status.charAt(0).toUpperCase()+d.status.slice(1):"Pending"}),l({value:d.paymentMode||"offline",label:"online"===d.paymentMode?"Online":"Offline"}),x({value:d.isVerified||!1,label:d.isVerified?"Yes":"No"}),d.manualMethod&&i({value:d.manualMethod,label:d.manualMethod.charAt(0).toUpperCase()+d.manualMethod.slice(1)}),d.supporter&&z({value:d.supporter._id,label:d.supporter.name,bedNo:null===(t=d.bed)||void 0===t?void 0:t.bedNo,bed:null===(n=d.bed)||void 0===n?void 0:n._id})}catch(e){console.error("Error fetching payment details:",e)}})()},[a,j]);let D=async e=>{_(!0);try{let s={...e,amount:Number(e.amount),...e.paymentDate&&{paymentDate:new Date(e.paymentDate).toISOString()}};if(a)(await U(s,"payment",a))._id?v.Z.success("Payment updated successfully"):v.Z.error("Error updating payment");else{let e=await (0,B.U)("payment",s);console.log(e),e._id?(v.Z.success("Payment created successfully"),S()):v.Z.error("Error creating payment")}}catch(e){console.error("Error submitting form:",e),v.Z.error("Error submitting form")}finally{_(!1)}},S=()=>{j("amount",0),j("status","pending"),j("paymentMode","offline"),j("isVerified",!1),j("currency","INR"),j("name",""),j("email",""),j("phNo",""),j("address",""),j("transactionReference",""),j("paymentDate",""),j("remarks",""),j("supporter",""),j("bed",""),l({value:"offline",label:"Offline"}),p({value:"pending",label:"Pending"}),x({value:!1,label:"No"}),i(void 0),z(void 0)};return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:["offline"===f("paymentMode")&&(0,r.jsx)(m.bZ,{className:"mb-6",children:(0,r.jsx)(m.X,{children:"Manual/offline payments require verification before being confirmed."})}),(0,r.jsxs)("form",{onSubmit:h(D),className:"bg-white dark:bg-gray-900 shadow-lg rounded-lg p-6 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"col-span-1 lg:col-span-2 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"amount",className:"required text-sm font-medium",children:"Amount (in paise) *"}),(0,r.jsx)(Z.I,{id:"amount",type:"number",...g("amount",{valueAsNumber:!0}),placeholder:"Enter amount in paise",className:"w-full ".concat(y.amount?"border-red-500":"")}),y.amount&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:y.amount.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"currency",className:"text-sm font-medium",children:"Currency"}),(0,r.jsx)(Z.I,{id:"currency",value:"INR",disabled:!0,className:"w-full bg-gray-100"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"paymentMode",className:"required text-sm font-medium",children:"Payment Mode *"}),(0,r.jsx)(O.ZP,{id:"paymentMode",options:[{value:"online",label:"Online"},{value:"offline",label:"Offline"}],value:s,onChange:e=>{l(e),j("paymentMode",e.value),"online"===e.value&&(i(void 0),j("manualMethod",void 0))},classNamePrefix:"select"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"status",className:"required text-sm font-medium",children:"Status *"}),(0,r.jsx)(O.ZP,{id:"status",options:[{value:"pending",label:"Pending"},{value:"captured",label:"Captured"},{value:"failed",label:"Failed"},{value:"cancelled",label:"Cancelled"},{value:"refunded",label:"Refunded"}],value:d,onChange:e=>{p(e),j("status",e.value)},classNamePrefix:"select"})]}),"offline"===f("paymentMode")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"manualMethod",className:"text-sm font-medium",children:"Manual Method"}),(0,r.jsx)(O.ZP,{id:"manualMethod",options:[{value:"cash",label:"Cash"},{value:"cheque",label:"Cheque"},{value:"upi",label:"UPI"},{value:"bank_transfer",label:"Bank Transfer"},{value:"other",label:"Other"}],value:n,onChange:e=>{i(e),j("manualMethod",e.value)},classNamePrefix:"select",placeholder:"Select method..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"transactionReference",className:"text-sm font-medium",children:"Transaction Reference"}),(0,r.jsx)(Z.I,{id:"transactionReference",...g("transactionReference"),placeholder:"Cheque no, UTR, etc.",className:"w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"paymentDate",className:"text-sm font-medium",children:"Payment Date"}),(0,r.jsx)(Z.I,{type:"date",id:"paymentDate",...g("paymentDate"),className:"w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"isVerified",className:"text-sm font-medium",children:"Verified Status"}),(0,r.jsx)(O.ZP,{options:[{value:!0,label:"Yes"},{value:!1,label:"No"}],value:u,onChange:e=>{x(e),j("isVerified",e.value)},classNamePrefix:"select"})]})]}),"online"===f("paymentMode")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"razorpay_payment_id",className:"text-sm font-medium",children:"Razorpay Payment ID"}),(0,r.jsx)(Z.I,{id:"razorpay_payment_id",...g("razorpay_payment_id"),placeholder:"Enter Razorpay payment ID",className:"w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"razorpay_order_id",className:"text-sm font-medium",children:"Razorpay Order ID"}),(0,r.jsx)(Z.I,{id:"razorpay_order_id",...g("razorpay_order_id"),placeholder:"Enter Razorpay order ID",className:"w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"razorpay_signature",className:"text-sm font-medium",children:"Razorpay Signature"}),(0,r.jsx)(Z.I,{id:"razorpay_signature",...g("razorpay_signature"),placeholder:"Enter Razorpay signature",className:"w-full"})]})]}),(0,r.jsx)("div",{className:"col-span-1 lg:col-span-2",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"supporter",className:"required",children:"Supporter *"}),(0,r.jsx)(q.Z,{cacheOptions:!0,loadOptions:T.zc,defaultOptions:!0,value:w,onChange:e=>{console.log(e),j("supporter",(null==e?void 0:e.value)||""),j("bed",(null==e?void 0:e.bed)||""),z(e)},classNamePrefix:"select",isClearable:!0,required:!0}),y.supporter&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:y.supporter.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"bed",className:"text-sm font-medium",children:"Bed No"}),(0,r.jsx)(Z.I,{id:"bed",...g("bed"),className:"w-full hidden"}),(0,r.jsx)(Z.I,{value:(null==w?void 0:w.bedNo)||"",placeholder:"Bed number",className:"w-full",disabled:!0}),y.bed&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:y.bed.message})]})]})}),(0,r.jsxs)("div",{className:"col-span-1 lg:col-span-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4 border-b pb-2",children:"Payer Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"name",className:"text-sm font-medium",children:"Payer Name"}),(0,r.jsx)(Z.I,{id:"name",...g("name"),placeholder:"Enter payer name",className:"w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"email",className:"text-sm font-medium",children:"Email"}),(0,r.jsx)(Z.I,{id:"email",type:"email",...g("email"),placeholder:"Enter payer email",className:"w-full ".concat(y.email?"border-red-500":"")}),y.email&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:y.email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"phNo",className:"text-sm font-medium",children:"Phone Number"}),(0,r.jsx)(Z.I,{id:"phNo",...g("phNo"),placeholder:"Enter payer phone number",className:"w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c._,{htmlFor:"address",className:"text-sm font-medium",children:"Address"}),(0,r.jsx)(Z.I,{id:"address",...g("address"),placeholder:"Enter payer address",className:"w-full"})]})]})]}),(0,r.jsxs)("div",{className:"col-span-1 lg:col-span-2",children:[(0,r.jsx)(c._,{htmlFor:"remarks",className:"text-sm font-medium",children:"Remarks"}),(0,r.jsx)("textarea",{id:"remarks",...g("remarks"),placeholder:"Enter any additional remarks or notes",className:"w-full min-h-[80px] px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-gray-600 dark:bg-gray-800 dark:text-white",rows:3})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center col-span-1 lg:col-span-2 pt-4 border-t",children:[(0,r.jsx)(o.z,{type:"button",onClick:S,className:"bg-gray-500 hover:bg-gray-600 text-white",disabled:N,children:a?"Cancel":"Clear"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[!a&&"offline"===f("paymentMode")&&(0,r.jsx)("span",{className:"text-sm text-amber-600 dark:text-amber-400 flex items-center",children:"⚠️ Will require verification"}),(0,r.jsx)(o.z,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white ".concat(N?"cursor-not-allowed opacity-50":""),disabled:N,children:N?"Processing...":a?"Update Payment":"Create Payment"})]})]})]})]})};function L(){let[e,a]=(0,t.useState)(!0),s=(0,i.I0)(),l=(0,i.v9)(e=>e.update.url),n=(0,i.v9)(e=>e.update.id);return(0,r.jsxs)("div",{className:"p-2 sm:p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("h1",{className:"text-lg font-semibold mb-2 text-bg2 flex justify-start",children:"Payments"}),"payment"===l?"":(0,r.jsx)(o.z,{onClick:()=>{s((0,R.Ib)()),s((0,u.Oe)()),a(!e)},className:"py-2 px-4 rounded-md hover:bg-bg2",children:e?"Add Payment":"View Payments"})]}),"payment"===l?n&&(0,r.jsx)("div",{}):e?(0,r.jsx)(I,{}):(0,r.jsx)(K,{})]})}}}]);