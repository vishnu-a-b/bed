(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5934],{571:function(e,a,t){Promise.resolve().then(t.bind(t,1257))},6979:function(e,a,t){"use strict";t.d(a,{ZP:function(){return n}});var s=t(1434),r=t(1119),l=t(2265),i=t(9448);t(8242),t(4887),t(7935);var n=(0,l.forwardRef)(function(e,a){var t=(0,s.u)(e);return l.createElement(i.S,(0,r.Z)({ref:a},t))})},1257:function(e,a,t){"use strict";t.d(a,{default:function(){return Z}});var s=t(7437),r=t(2265),l=t(8438),i=t(3618),n=t(386);function o(e){if(!e)return"Invalid date";let a=new Date(e);if(isNaN(a.getTime()))return"Invalid date";let t=new Date,s=t.getFullYear()-a.getFullYear();return t.getMonth()>a.getMonth()||t.getMonth()===a.getMonth()&&t.getDate()>=a.getDate()||(s-=1),s}var d=t(4291),c=t(2381),u=t(9376),m=t(7520),f=t(9501),g=t(3590),h=t(1229),x=t(279),v=t(5060),p=t(4978),j=t(9093),N=t(2786);let b=h.z.object({password:h.z.string().min(8,{message:"Password must be at least 8 characters long"}).regex(/[A-Z]/,{message:"Password must contain at least one uppercase letter"}).regex(/[a-z]/,{message:"Password must contain at least one lowercase letter"}).regex(/[0-9]/,{message:"Password must contain at least one number"}).regex(/[\W_]/,{message:"Password must contain at least one special character"})});var w=e=>{let{staffId:a}=e,{handleSubmit:t,register:r,formState:{errors:l},setError:i}=(0,f.cI)({resolver:(0,g.F)(b)}),n=async e=>{try{let t=(await (0,N.bp)(a,"staff")).items.user._id;(await (0,j.V)({password:e.password},"user",t,!0))._id?p.Z.success("Password updated successfully"):(i("password",{message:"Error updating password"}),p.Z.error("Error updating password"))}catch(e){console.error("Error updating password:",e),p.Z.error("Error updating password")}};return(0,s.jsxs)("form",{onSubmit:t(n),className:"grid grid-cols-1 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(v._,{htmlFor:"password",className:"required",children:"New Password"}),(0,s.jsx)(x.I,{id:"password",...r("password"),placeholder:"Enter new password",type:"text",className:"w-full ".concat(l.password?"border-red-500":"")}),l.password&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:l.password.message})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(c.z,{type:"submit",children:"Update Password"})})]})};let y=[{accessorKey:"name",header:"Name"},{accessorKey:"user.mobileNo",header:"Phone No"},{accessorKey:"user.dateOfBirth",header:"Age",cell:e=>{var a;return(null===(a=e.row.original.user)||void 0===a?void 0:a.dateOfBirth)?o(e.row.original.user.dateOfBirth):"N/A"}},{accessorKey:"viewDetails",header:"View Details",cell:e=>{let a=e.row.original;return(0,s.jsxs)(d.Vq,{children:[(0,s.jsx)(d.hg,{className:" underline",children:(0,s.jsx)("button",{className:"px-4 p-1 text-white bg-sidebar-primary rounded-full",children:"View"})}),(0,s.jsx)(d.cZ,{className:"p-6",children:(0,s.jsx)(S,{data:a})})]})}}],S=e=>{var a,t;let{data:r}=e;console.log(r);let l=(0,n.I0)();return(0,u.useRouter)(),(0,s.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:r.name}),(0,s.jsx)("br",{}),(0,s.jsxs)("p",{children:["Age :",r.user.dateOfBirth?o(r.user.dateOfBirth):"N/A"]}),(0,s.jsx)("br",{}),"Phone No : ",null==r?void 0:null===(a=r.user)||void 0===a?void 0:a.mobileNo,(0,s.jsx)("br",{}),"Email : ",null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.email]})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(c.z,{className:" text-sm",onClick:e=>{l((0,m.R5)("staff")),l((0,m.h9)(r._id))},children:"Edit"}),(0,s.jsxs)(d.Vq,{children:[(0,s.jsx)(d.hg,{asChild:!0,children:(0,s.jsx)(c.z,{className:"text-sm",children:"Change Password"})}),(0,s.jsx)(d.cZ,{className:"sm:max-w-[425px]",children:(0,s.jsx)(w,{staffId:r._id})})]})]})]})};function z(){var e;let a;let[t,o]=(0,r.useState)([]),[d,c]=(0,r.useState)(0),[u,m]=(0,r.useState)(0),[f,g]=(0,r.useState)(10),[h,x]=(0,r.useState)(""),[v,p]=(0,r.useState)(""),[j,N]=(0,r.useState)(""),b=(0,n.v9)(e=>e.update.refresh),w=(0,n.v9)(e=>e.staff.id);(0,n.v9)(e=>e.organization.id);let S=(0,r.useCallback)((e=e=>{N(e),m(0)},function(){for(var t=arguments.length,s=Array(t),r=0;r<t;r++)s[r]=arguments[r];clearTimeout(a),a=setTimeout(()=>{e(...s)},500)}),[]);async function z(){try{let e="";if(w){let e=await i.YD.get("/staff/".concat(w));console.log(e);let a=[];return a[0]=e.data.data,c(1),a}"Active"===v?e="isActive__eq=true&":"InActive"===v&&(e="isActive__eq=false&");let a=(await i.YD.get("/staff?limit=".concat(f,"&skip=").concat(u*f,"&").concat(e).concat(j?"search=".concat(j):""))).data.data;return c(a.total),a.items}catch(e){console.error("Error fetching data:",e)}}return(0,r.useEffect)(()=>{(async function(){o(await z())})()},[u,f,j,v,b,w]),(0,s.jsx)("div",{className:"flex flex-col items-center p-4",children:(0,s.jsxs)("div",{className:"container mx-auto py-10",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("input",{type:"text",value:h,onChange:e=>{let a=e.target.value;x(a),S(a)},placeholder:"Search...",className:"mb-4 p-2 border rounded"}),(0,s.jsxs)("select",{value:v,onChange:e=>{p(e.target.value),m(0)},className:"mb-4 p-2 border border-gray-300 rounded",children:[(0,s.jsx)("option",{value:"all",children:"All"}),(0,s.jsx)("option",{value:"Active",children:"Active"}),(0,s.jsx)("option",{value:"InActive",children:"InActive"})]})]}),(0,s.jsx)(l.w,{url:"staff",columns:y,data:t,totalRows:d,pageIndex:u,pageSize:f,onPageChange:m,onPageSizeChange:g,actions:{delete:!0,edit:!0}})]})})}var _=t(9542),I=t(6979),O=t(662),A=t(7810),E=t(3965),P=t(4395),C=t(6528);let B=h.z.object({name:h.z.string().min(1,{message:"Name is required"}).max(100),mobileNo:h.z.string().min(1,{message:"Mobile number is required"}).max(20),password:h.z.string().optional(),email:h.z.string().optional().refine(e=>!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),{message:"Invalid email format"}),role:h.z.string().optional(),userId:h.z.string().optional(),dateOfBirth:h.z.string().optional(),gender:h.z.enum(["Male","Female","Other"],{message:"Gender is required"}).optional(),maritalStatus:h.z.enum(["Unknown","Bachelor","Married","Divorced","Widower"],{message:"Invalid marital status"}).optional(),country:h.z.string().optional(),organization:h.z.string().optional(),isActive:h.z.boolean().default(!0)});var k=e=>{let{staffId:a}=e,t=(0,n.v9)(e=>e.organization.id),l=(0,n.v9)(e=>e.organization.name),[i,o]=(0,r.useState)({id:t,label:l}),d=(0,n.I0)(),[u,h]=(0,r.useState)(),[b,w]=(0,r.useState)({value:"Male",label:"Male"}),[y,S]=(0,r.useState)({value:"Unknown",label:"Unknown"}),[z,_]=(0,r.useState)({value:!0,label:"Active"}),[k,Z]=(0,r.useState)([]),{handleSubmit:D,register:q,setValue:F,formState:{errors:M},setError:U}=(0,f.cI)({resolver:(0,g.F)(B)}),[V,R]=(0,r.useState)(!1),Y="staff";(0,r.useEffect)(()=>{(async()=>{try{let e=(await (0,N.fp)()).items.map(e=>({value:e._id,label:e.title,slug:e.slug})).find(e=>e.slug===Y);e&&Z([e])}catch(e){console.error("Error fetching roles:",e)}})()},[Y]),(0,r.useEffect)(()=>{a&&(async()=>{try{var e,t,s,r,l,i,n,d,c,u,m,f,g,x,v,p;let j=(await (0,N.bp)(a,"staff")).items;if(console.log(null===(e=j.user)||void 0===e?void 0:e.isActive),F("name",j.name),F("mobileNo",null===(t=j.user)||void 0===t?void 0:t.mobileNo),F("email",null===(s=j.user)||void 0===s?void 0:s.email),null===(r=j.user)||void 0===r?void 0:r.dateOfBirth){let e=new Date(j.user.dateOfBirth).toISOString().split("T")[0];F("dateOfBirth",e)}w({value:null===(l=j.user)||void 0===l?void 0:l.gender,label:null===(i=j.user)||void 0===i?void 0:i.gender}),_({value:null===(n=j.user)||void 0===n?void 0:n.isActive,label:(null===(d=j.user)||void 0===d?void 0:d.isActive)?"Active":"Inactive"}),S({value:null===(c=j.user)||void 0===c?void 0:c.maritalStatus,label:null===(u=j.user)||void 0===u?void 0:u.maritalStatus}),h({label:null==j?void 0:null===(m=j.country)||void 0===m?void 0:m.name,id:null==j?void 0:null===(f=j.country)||void 0===f?void 0:f._id}),o({label:null==j?void 0:null===(g=j.organization)||void 0===g?void 0:g.name,id:null==j?void 0:null===(x=j.organization)||void 0===x?void 0:x._id}),F("userId",null===(v=j.user)||void 0===v?void 0:v._id),F("role",null===(p=j.user)||void 0===p?void 0:p.role),F("isActive",j.isActive)}catch(e){console.error("Error fetching staff details:",e)}})()},[a,F]);let K=async(e,t)=>{console.log(k),R(!0),null==t||t.preventDefault();try{let t="User@"+e.mobileNo,s={...e.name&&{name:e.name},...e.mobileNo&&{mobileNo:e.mobileNo},...e.email&&{email:e.email},...e.dateOfBirth&&{dateOfBirth:e.dateOfBirth},...b&&{gender:b.value},...y&&{maritalStatus:y.value},isActive:e.isActive,...a?{}:{password:t}},r=new FormData;if(Object.entries(s).forEach(e=>{let[a,t]=e;Array.isArray(t)?t.forEach(e=>r.append(a,e)):"string"==typeof t||t instanceof Blob?r.append(a,t):console.warn('Skipping key "'.concat(a,'" with unsupported value type.'))}),k.forEach((e,a)=>r.append("roles[".concat(a,"]"),e.value)),console.log(s),a){let t=await (0,j.V)(r,"user",e.userId||""),s={...e.name&&{name:e.name},...i.id&&{organization:i.id},...u.id&&{country:u.id},...e.userId&&{user:e.userId},isActive:e.isActive,role:"regular-staff"},l=await (0,j.V)(s,"staff",a);l._id?t._id?p.Z.success("Staff updated successfully"):(U(t.id,{message:t.value}),p.Z.error("Error updating staff")):(U(l.id,{message:l.value}),p.Z.error("Error updating staff"))}else{let a=await (0,O.U)("user",r);if(a._id){let t={...e.name&&{name:e.name},...i.id&&{organization:i.id},...u.id&&{country:u.id},...e.staffRole&&{role:e.staffRole},user:a._id,role:"regular-staff"},s=await (0,O.U)("staff",t);s._id?(p.Z.success("Staff created successfully"),T()):((0,C.S)("/user",a._id),U(s.id,{message:a.value}),p.Z.error("Error creating staff"))}else U(a.id,{message:a.value}),p.Z.error("Error creating user")}}catch(e){console.error("Error submitting form:",e),p.Z.error("Error submitting form")}finally{R(!1)}},T=()=>{F("name",""),F("mobileNo",""),F("email",""),F("dateOfBirth",void 0),d((0,m.Oe)())},W=async e=>(await (0,N.tE)(e)).items.map(e=>({id:e._id,label:e.name}));return(0,s.jsxs)("form",{onSubmit:D(K),className:"max-w-lg mx-auto  p-4 bg-primary-foreground dark:bg-gray-900 shadow-lg rounded-lg grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"col-span-1 lg:col-span-2",children:[(0,s.jsx)(v._,{htmlFor:"name",className:"required",children:"Name"}),(0,s.jsx)(x.I,{id:"name",...q("name"),placeholder:"Enter name",className:"w-full ".concat(M.name?"border-red-500":"")}),M.name&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:M.name.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(v._,{htmlFor:"mobileNo",className:"required",children:"Mobile Number"}),(0,s.jsx)(x.I,{id:"mobileNo",...q("mobileNo"),placeholder:"Enter mobile number",className:"w-full ".concat(M.mobileNo?"border-red-500":"")}),M.mobileNo&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:M.mobileNo.message})]}),(0,s.jsxs)("div",{className:"hidden",children:[(0,s.jsx)(v._,{htmlFor:"password",className:"required",children:"Password"}),(0,s.jsx)(x.I,{id:"password",...q("password"),placeholder:"Enter password",type:"text",className:"w-full ".concat(M.password?"border-red-500":"")}),M.password&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:M.password.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(v._,{htmlFor:"email",children:"Email"}),(0,s.jsx)(x.I,{id:"email",...q("email"),placeholder:"Enter email",className:"w-full"}),M.email&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:M.email.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(v._,{htmlFor:"dateOfBirth",children:"Date of Birth"}),(0,s.jsx)(x.I,{type:"date",id:"dateOfBirth",...q("dateOfBirth",{valueAsDate:!1})}),M.dateOfBirth&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:M.dateOfBirth.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(v._,{children:"Gender"}),(0,s.jsx)(I.ZP,{id:"gender",name:"gender",value:b,options:E.P,classNamePrefix:"select",onChange:e=>{F("gender",e.value),w(e)}}),M.gender&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:M.gender.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(v._,{htmlFor:"maritalStatus",children:"Marital Status"}),(0,s.jsx)(I.ZP,{id:"maritalStatus",name:"maritalStatus",options:[{value:"Unknown",label:"Unknown"},{value:"Bachelor",label:"Bachelor"},{value:"Married",label:"Married"},{value:"Divorced",label:"Divorced"},{value:"Widower",label:"Widower"}],classNamePrefix:"select",value:y,onChange:e=>{F("maritalStatus",e.value),S(e)}}),M.maritalStatus&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:M.maritalStatus.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(v._,{htmlFor:"organization",className:"required",children:"Organization"}),(0,s.jsx)(A.Z,{cacheOptions:!0,loadOptions:P.Tz,defaultOptions:!0,value:i,onChange:e=>{o(e)},classNamePrefix:"select",required:!0,isDisabled:!0}),M.organization&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:M.organization.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(v._,{htmlFor:"country",className:"required",children:"Country"}),(0,s.jsx)(A.Z,{cacheOptions:!0,loadOptions:W,defaultOptions:!0,value:u,onChange:e=>{h(e)},classNamePrefix:"select",required:!0,isClearable:!0}),M.country&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:M.country.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(v._,{children:"Status"}),(0,s.jsx)(I.ZP,{options:[{value:!0,label:"Active"},{value:!1,label:"Inactive"}],value:z,onChange:e=>{_(e),F("isActive",e.value)}})]}),(0,s.jsxs)("div",{className:"flex justify-between col-span-1 lg:col-span-2",children:[(0,s.jsx)(c.z,{onClick:T,className:" bg-slate-400 hover:bg-slate-500",children:a?"Cancel":"Clear"}),(0,s.jsx)(c.z,{className:V?"cursor-not-allowed opacity-50":"",type:"submit",children:a?"Update":"Create"})]})]})};function Z(){let[e,a]=(0,r.useState)(!0),t=(0,n.I0)(),l=(0,n.v9)(e=>e.update.url),i=(0,n.v9)(e=>e.update.id);return(0,s.jsxs)("div",{className:"p-2 sm:p-4",children:[(0,s.jsxs)("div",{className:" flex justify-between",children:[(0,s.jsx)("h1",{className:"text-lg font-semibold mb-2 text-bg2 flex justify-start",children:"Staff"}),"staff"===l?"":(0,s.jsx)(c.z,{onClick:()=>{t((0,_.rS)()),t((0,m.Oe)()),a(!e)},className:" py-2 px-4 rounded-md hover:bg-bg2",children:e?"Add Staff":"View Staff"})]}),"staff"===l?i&&(0,s.jsx)(k,{staffId:i}):e?(0,s.jsx)(z,{}):(0,s.jsx)(k,{})]})}},4291:function(e,a,t){"use strict";t.d(a,{Be:function(){return g},Vq:function(){return o},cZ:function(){return m},fK:function(){return f},hg:function(){return d}});var s=t(7437),r=t(2265),l=t(9027),i=t(653),n=t(3448);let o=l.fC,d=l.xz,c=l.h_;l.x8;let u=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.aV,{ref:a,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});u.displayName=l.aV.displayName;let m=r.forwardRef((e,a)=>{let{className:t,children:r,...o}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(u,{}),(0,s.jsxs)(l.VY,{ref:a,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...o,children:[r,(0,s.jsxs)(l.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(i.Pxu,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.VY.displayName;let f=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...t})};f.displayName="DialogHeader",r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.Dx,{ref:a,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})}).displayName=l.Dx.displayName;let g=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.dk,{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",t),...r})});g.displayName=l.dk.displayName},3965:function(e,a,t){"use strict";t.d(a,{P:function(){return s}});let s=[{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Other",label:"Other"}]},9542:function(e,a,t){"use strict";t.d(a,{Lx:function(){return c},hz:function(){return r},qC:function(){return d},rS:function(){return l}});let s=(0,t(1455).oM)({name:"staff",initialState:{id:null,name:null,userId:null,userName:null},reducers:{setStaffId:(e,a)=>{e.id=a.payload},clearStaffId:e=>{e.id=null},setUserName:(e,a)=>{e.userName=a.payload},setUserId:(e,a)=>{e.userId=a.payload},clearUser:e=>{e.userId=null,e.userName=null},setName:(e,a)=>{e.name=a.payload},clearName:e=>{e.name=null}}}),{setStaffId:r,clearStaffId:l,setUserName:i,setUserId:n,clearUser:o,setName:d,clearName:c}=s.actions;a.ZP=s.reducer},6528:function(e,a,t){"use strict";t.d(a,{S:function(){return r}});var s=t(3618);let r=async(e,a)=>{try{let t=await s.YD.delete("".concat(e,"/").concat(a));return console.log(t),t}catch(e){console.error("Error deleting data:",e)}}}},function(e){e.O(0,[8310,9599,2234,7261,1425,2519,9027,3402,2329,1316,2971,2117,1744],function(){return e(e.s=571)}),_N_E=e.O()}]);